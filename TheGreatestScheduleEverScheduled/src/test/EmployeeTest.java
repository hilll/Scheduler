package test;

import static org.junit.Assert.*;

import java.util.ArrayList;

import org.junit.Test;

import model.Availability;
import model.Employee;
import model.TimeSlot;

public class EmployeeTest {
	
	private final String[] starterAvailability = { "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
			   "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
            "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
            "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
            "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
            "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
            "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",	   
			 };
	private final String[] completelyUnavailable = { "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
			   "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",	   
			 };
	private final String[] smallAvailabilities = { "111100000000000000000000000000000000000011111110000000000000000000000000000000000000000000000001",
			   "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",	   
			 };
	private final String[] availableMornings = { "000000000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000",
			   "000000000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000",	   
			 };

	@Test
	public void test() {
		Employee newEmp = new Employee(0, "New", "Employee", "email",  null, false);
		assertEquals(0, newEmp.getID());
		assertEquals("New", newEmp.getFirstName());
		assertEquals("Employee", newEmp.getLastName());
		assertEquals("New Employee", newEmp.getFullName());
		assertFalse(newEmp.getIsManager());
		for (int i = 0; i < 7; i++) {
			assertEquals(starterAvailability[i], newEmp.getAvailability().getAvailabilityStrings()[i]);
		}
		assertEquals(7, newEmp.getAvailability().getAvailabilityByDay().size());
		int j;
		for (j = 0; j < 7; j++) {
			assertEquals(1, newEmp.getAvailability().getAvailabilityByDay().get(j).size());
		}
		assertEquals(0, newEmp.getAvailability().getUnavailabilityList().size());
		
		
		Availability avail = new Availability(completelyUnavailable, newEmp.getIsManager());
		newEmp.setAvailability(avail);
		for (j = 0; j < 7; j++) {
			assertEquals(0, newEmp.getAvailability().getAvailabilityByDay().get(j).size());
		}
		assertEquals(7, newEmp.getAvailability().getUnavailabilityList().size());
		
		avail = new Availability(availableMornings, newEmp.getIsManager());
		newEmp.setAvailability(avail);
		for (j = 0; j < 7; j++) {
			ArrayList<TimeSlot> slots = newEmp.getAvailability().getAvailabilityByDay().get(j);
			assertEquals(1, slots.size());
			TimeSlot curr = slots.get(0);
			assertEquals(j, curr.getDay());
			assertEquals(24, curr.getStart());
			assertEquals(39, curr.getEnd());
			assertEquals(-1, curr.getID());
			assertEquals(false, curr.getIsManagerTimeSlot());
		}
		assertEquals(14, newEmp.getAvailability().getUnavailabilityList().size());
	}
	
	@Test
	public void testInsertAndDelete() {
		// placeholder
	}

	@Test
	public void testUpdate() {
		Employee emp = Employee.loadFromID(1, null);
		assertEquals(1, emp.getID());
		assertEquals("Katie", emp.getFirstName());
		assertEquals("Walters", emp.getLastName());
		assertEquals("Katie Walters", emp.getFullName());
		assertEquals("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n" +
					"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
					"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
					"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
					"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
					"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
					"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", 
					emp.getAvailability().toString());
		assertTrue(emp.getAvailability().updateAvailabilityStrings(0, 0, 95, '1'));
		assertEquals("111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", 
				emp.getAvailability().toString());
		emp.save();
		Employee emp2 = Employee.loadFromID(1, null);
		assertEquals(1, emp.getID());
		assertEquals("Katie", emp.getFirstName());
		assertEquals("Walters", emp.getLastName());
		assertEquals("Katie Walters", emp.getFullName());
		assertEquals("111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", 
				emp2.getAvailability().toString());
		// reset so the test will pass on second run too.
		assertTrue(emp.getAvailability().updateAvailabilityStrings(0, 0, 95, '0'));
		assertEquals("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000\n" +
				"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", 
				emp.getAvailability().toString());
		emp.save();
	}
	
	@Test
	public void testLogin() {
		assertEquals(Employee.getIDForLogin("swhite", "swhite"), 0);
		assertEquals(Employee.getIDForLogin("kwalters", "kwalters"), 1);
		assertEquals(Employee.getIDForLogin("rkaye", "rkaye"), 2);
		assertEquals(Employee.getIDForLogin("lhill", "lhill"), 3);
		assertEquals(Employee.getIDForLogin("INVALID", "INVALID"), -1);
	}
	
	@Test
	public void testHavingBusinessLoadedWhenEmployeeLoads() {
		Employee ryan = Employee.loadFromID(2, null);
		assertEquals(0, ryan.getBusiness().getID());
	}
}
